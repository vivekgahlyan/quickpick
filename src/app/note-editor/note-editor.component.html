<div class="container py-0">
    <div class="card p-0 border-0 shadow-lg rounded-4">
        <div class="card-body">

            <h1 class="display-5 fw-bold text-center mb-3 gradient-text">QuickPick Notes</h1>

            <div class="border rounded-3 shadow-sm overflow-hidden">
                <div class="formatting-bar bg-light p-2 border-bottom">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary"
                            (click)="applyFormat('bold')"><b>B</b></button>
                        <button type="button" class="btn btn-outline-secondary"
                            (click)="applyFormat('italic')"><i>I</i></button>
                        <button type="button" class="btn btn-outline-secondary"
                            (click)="applyFormat('underline')"><u>U</u></button>
                        <button type="button" class="btn btn-outline-secondary"
                            (click)="applyFormat('insertUnorderedList')">â€¢ List</button>

                        <!-- Clear button added in the same element as format buttons -->
                        <button type="button" class="btn btn-outline-danger" (click)="clearAll()">
                            Clear
                        </button>
                    </div>
                </div>

                <!-- make this area fill remaining space and scroll internally -->
                <!-- removed native placeholder attribute; use data-placeholder + class binding -->
                <div #noteContent
                     class="editable-content"
                     [class.empty]="noteEmpty"
                     [attr.data-placeholder]="placeholderText"
                     contenteditable="true"
                     spellcheck="false"
                     (input)="onNoteChange()"
                     (focus)="onEditorFocus()">
                </div>
            </div>

            <div class="d-flex justify-content-end text-muted mt-1 px-1">
                <small>{{ charCount }}/{{ MAX_CHARS }}</small>
            </div>

            <div class="text-center mt-4">
                <!-- replaced plain button with gradient + shiny icon -->
                <button class="btn ai-gradient-btn" (click)="reorganizeNotes()" type="button" aria-label="Re-organize with AI">
                    <span class="ai-icon" aria-hidden="true">
                        <!-- simple shiny spark / lightning SVG (inline for crispness) -->
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" focusable="false">
                            <path d="M13 2L3 14h7l-1 8L21 10h-7l-1-8z" fill="currentColor" />
                        </svg>
                    </span>
                    <span class="ai-label">Re-organize with AI</span>
                </button>
            </div>

            <div #aiOutputSection *ngIf="isAiOutputVisible"
                class="ai-output mt-3 rounded-3 border-start border-5 border-primary bg-light">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="h5 fw-bold text-primary mb-0">Organized Notes</h2>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3" (click)="copyOutput()">
                            Copy
                        </button>
                        <!-- Discard button: removes AI output and focuses editor -->
                        <button style="margin-left: 2px;" class="btn btn-sm btn-outline-danger rounded-pill px-3" (click)="discardAiOutput()">
                            Discard
                        </button>
                    </div>
                </div>
                <div class="text-secondary small" [innerHTML]="aiOutputContent">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
    <div class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true"
        [class.show]="isMessageBoxVisible">
        <div class="d-flex">
            <div class="toast-body">
                {{ messageBoxText }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="isMessageBoxVisible = false"
                aria-label="Close"></button>
        </div>
    </div>
</div>